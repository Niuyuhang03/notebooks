# 计算机网络体系结构

## 计算机网络定义与分类
+ 计算机网络组成
    + 从组成部分上看：
        + 硬件：主机（端系统）、通信链路（双绞线、光纤）、交换设备（路由器、交换器）、通信处理机（网卡）
        + 软件
        + 协议
    + 从工作方式上看：
        + 边缘部分：主机
        + 核心部分：网络和路由器
    + 从功能组成上看：
        + ==通信子网==
        + ==资源子网==
+ 计算机网络分类
    + 按分布范围分类：
        + 广域网WAN：范围大，点对点，基于交换技术
        + 城域网MAN
        + 局域网LAN：范围小，广播
        + 个人区域网PAN
    + 按传输技术分类：
        + ==广播式网络：局域网==
        + ==点对点网络：广域网==
    + 按拓扑结构分类：根据通信子网的拓扑结构
        + 星型网络：局域网中。每个计算机单独与中央设备连接。成本高，对中心结点故障敏感
        + 总线型网络：局域网中。单根传输线连接。对总线任意一处故障敏感
        + 环形网络：局域网中。连接成一个环
        + 网状型网络：广域网中。可靠，但复杂，成本高
    + 按使用者分类：
        + 公用网
        + 专用网
    + 按交换技术分类：
        + 电路交换网络
        + 报文交换网络（存储转发网络）
        + 分组交换网络（包交换网络）
    + 按传输介质分类：
        + 有线网络
        + 无线网络
+ 计算机网络性能指标
    + ==带宽（最高数据率）== b/s：网络通信线路传送数据能力
    + ==**时延=发送时延+传播时延**+处理时延+排队时延==：数据从链路一段到另一端时间
        + ==发送时延（**传输**时延）=分组长度/信道宽度==：开始发送分组第一个比特到该分组最后一个比特发送完的时间
        + ==传播时延=信道长度/电磁波传播速率==：电磁波在信道中传播时间
        + 处理时延：数据在交换结点为存储转发进行处理的时间
        + 排队时延：分组进入路由器中排队等待的时间
    + ==时延带宽积=传播时延\*信道带宽：发送端第一个比特到达终点时，发送端已发出比特数==
    + 往返时延RTT：发送开始到发送端收到来自接收端的确认
    + 吞吐量：单位时间内数据量
    + 速率（数据率、比特率）：最高数据率为带宽

## 网络标准化工作及相关组织

+ 计算机网络标准化工作及相关组织：因特网标准由国际标准化组织ISO、国际电信联盟ITU和国际电气电子工程师协会IEEE以==RFC==形式发布，但发布的RFC变为因特网标准要经过下面步骤才会变成正式标准：
    + 因特网草案
    + 建议标准：成为RFC文档
    + 草案标准
    + 因特网标准

## 计算机网络体系结构
+ ==第n层的协议数据单元n-PDU=第n层服务数据单元n-SDU+第n层协议控制信息n-PCI，(n+1)-PDU=n-SDU==
+ ==协议Protocol：两对等实体之间==，进行网络中数据交换而建立的规则。上下层之间透明
    + 语法：规定数据传输格式
    + 语义：规定要完成的功能
    + 同步：规定事件实现顺序
+ 接口：两层间交换信息，第n层的服务访问点SAP就是第n+1层访问第n层服务的地方
+ ==服务：下层为上层==提供的功能调用，==只有一层内能被上层看见的功能才是服务==。上层使用下层服务时需要服务原语作为命令
    + 服务原语
        + 请求：上层发给下层，请求完成某项工作
        + 指示：下层发给上层，只是用户做某件事
        + 响应：上层发往下层，响应指示
        + 证实：下层发往上层，证实请求
    + 服务分类
        + 面向连接服务和无连接服务
            + 面向连接服务：通信前必须建立连接，如TCP
            + 无连接服务：不建立连接，直接发送数据，不保证通信可靠性，如UDP，IP
        + 可靠服务和不可靠服务
            + 可靠服务：具有纠错、检错、应答机制，保证数据正确可靠地送到目的地
            + 不可靠服务：尽量正确可靠传送，不保证正确可靠
        + 有应答服务和无应答服务
+ ==OSI参考模型（开放系统互连参考模型）==：上三层为资源子网，下三层为点对点的通信子网，==端对端的传输层承上启下==

| 层号 | 层级                   | 传输单位                           | 服务访问点SAP              | 功能                                                         | 协议                                                         |
| ---- | ---------------------- | ---------------------------------- | -------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 7    | 应用层                 |                                    | 用户界面                   | ==**提供用户和网络的接口**==                                 | 用于文件传送的FTP、用于电子邮件的SMTP、用于万维网的HTTP      |
| 6    | ==表示层==             |                                    |                            | ==**数据格式转换**==，即通信系统-通信系统的数据压缩、加密、解密 |                                                              |
| 5    | ==会话层==             |                                    |                            | ==**会话的管理和同步**==，即主机间的建立、管理、终止进程间会话 |                                                              |
| 4    | 传输层（运输层）       | ==**报文段TCP 或 用户数据报UDP**== | ==**端口号**（套接字）==   | ==**为端到端连接（进程-进程）提供可靠的传输服务**==，==**面向连接**==， 即流量控制、差错控制、服务质量、数据传输管理 | TCP、UDP                                                     |
| 3    | 网络层（网际层、IP层） | ==**数据报或分组**==               | ==**IP地址（网络地址）**== | ==**控制报文通过网络的路由选择**==，==**无连接或面向连接**==，即路由选择、流量控制、拥塞控制、差错控制、网际互连 | 无连接的网际协议和路由选择协议<br>如IP、IPX、IXMP、IGMP、ARP、RARP、OSPF |
| 2    | 数据链路层             | ==**帧**==                         | ==**MAC地址**==            | ==**点对点（主机-主机） 中保证二进制数据正确顺序和完整性**==，成帧、差错控制、流量控制、传输管理、控制对共享信道的访问 | SDLC、HDLC、PPP、STP、帧中继                                 |
| 1    | 物理层                 | 比特                               | ==**网卡接口**==           | ==**处理信号通过介质的传输**==，即在物理媒体上为数据端设备透明的传输原始比特流，规定电路接口的参数，规定通信链路上传输信号的意义和电器特征 | 又叫物理层接口标准、物理层规程<br>如EIA-232C、EIA/TIA RS-449、CCITT的X.21 |
| 0    | 物理媒体               |                                    |                            | 双绞线、光缆、无线信道等                                     |                                                              |

+ ==TCP/IP==模型：事实上的国际标准。IP协议是核心协议

| 层级                                          | 作用                                                         | 协议                                                         |
| --------------------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 应用层（对应OSI的应用层、表示层、会话层）     | 用户-用户                                                    | 虚拟终端协议Telnet、文件传输协议FTP、域名解析服务DNS、电子邮件协议SMTP、超文本传输协议HTTP |
| 传输层                                        | 进程-进程或应用-应用的无连接或面向连接会话                   | 传输控制协议TCP：面向连接，传输单位是报文段，提供可靠交付<br>用户数据报协议UDP：无连接，传输单位是用户数据报，不保证提供可靠交付 |
| 网际层                                        | 主机-主机，将分组发往任何网络，选择合适路由，但不保证分组有序到达，无连接 | IP，目前为IPv4，以后为IPv6                                   |
| ==网络接口层==（对应OSI的应用层、数据链路层） | 从主机或结点接收IP分组，发送到指定物理网络上                 |                                                              |

+ OSI参考模型和TCP/IP模型区别：==**面二、二无**==
    + OSI在传输层只支持面向连接，网络层支持无连接和面向连接
    + TCP/IP在传输层支持无连接和面向连接，网际层只支持无连接
+ 五层模型

| OSI参考模型 | 五层模型   | TCP/IP模型 |
| ----------- | ---------- | ---------- |
| 应用层      |            |            |
| 表示层      | 应用层     | 应用层     |
| 会话层      |            |            |
| 传输层      | 传输层     | 传输层     |
| 网络层      | 网络层     | 网际层     |
| 数据链路层  | 数据链路层 |            |
| 物理层      | 物理层     | 网络接口层 |

## 零碎知识点
+ ==高速链路==：数据发送速率高，即==发送==时延短
+ ==世界上最早的计算机网络：ARPAnet==
+ OSI参考模型中，==只有传输层及以上为端到端（端口到端口，即进程到进程）==

# 物理层

## 数据通信的基础知识
+ 数据和信号
    + 数据：信息实体
    + 信号：数据在传输过程中的存在形式
+ 模拟和数字
    + ==模拟：连续==
    + ==数字：离散==
+ 数据传输方式
    + 串行：距离长，较经济
    + 并行：距离短，速度快
+ 码元：用一个固定时长的信号波形表示以为k进制数字，时长称为码元宽度
+ 数据通信：单工通信（一条信道，只有一个方向通信），半双工通信（两条信道，双向通信，但任意一方不能同时发送和接受），全双工通信（两条信道，双方可同时发送接收）
    + 信源：产生和发送数据的源头
    + 信道：信号的传输媒介，一般为一条发送信道和一条接受信道
        + ==基带传输Base==：基带信号将数字0和1用两种电压表示，送到==数字==信道传输
        + 宽带传输（频带传输）：宽带信号将基带信号进行调制后形成频分复用模拟信号，送到模拟信道上传输
    + 信宿：信号接收端
+ 速率（数据率）
    + ==码元传输速率（码元速率、波形速率、**波特率**）：单位时间内传输码元个数（脉冲个数、**信号变化次数**），单位Baud波特==
    + ==信息传输速率（信息速率、比特率）=**波特率$*\log_2n$**，n为一个码元离散值个数==：单位时间内传输二进制码元个数，单位b/s。==顺序==
+ ==奈奎斯特定理（奈氏准则）==
    + ==**理想**低通信道下==的极限码元传输率=$2W$，==极限数据传输率=$2W\log_2n\ b/s$==，W为无噪声低通信道带宽Hz，n为每个码元离散电平数目（即多少种不同码元）
    + 对码元传输速率给出限制，超过上限后接收端不可能完全正确识别码元。没有对一个码元可以对应多少个二进制位给出限制
+ ==香农定理==：
    + ==**有噪声时**信道的极限数据传输率=$W\log_2(1+信噪比值S/N)\ b/s$==，W为信道的带宽Hz，S为信道所传输信号的平均功率，N为信道内部的高斯噪声功率，==**信噪比S/N(dB)=$10*\log_{10}(信噪比值S/N)$**==
+ 编码和调制：编码指数据变为数字信号，调制指数据变为模拟信号
    + ==数字数据编码为数字信号==：用于基带传输
        + ==非归零编码NRZ：一个码元一个电压==。容易实现，但没有检错功能，无法同步
        + ==曼彻斯特编码：一个码元两个电压==。==以太网==使用，可以每个码元中间的电平跳变用于同步，但频带宽度变为二倍
        + ==差分曼彻斯特编码：一个码元两个电压，且1的前半码元电平和上一码元的后半相同，0则变化==。可以自同步，抗干扰性好
        + 4B/5B编码：4位数据为一组，转换为5位码，其32种中16种作为控制码
    + ==数字数据调制为模拟信号==：用于发送端将数字信号转换为模拟信号，接收端还原为数字信号
        + 幅移键控ASK：改变载波信号振幅。容易实现，但抗干扰能力差
        + 频移键控FSK：改变载波信号频率。使用广泛，容易实现，但抗干扰能力差
        + 相移键控PSK：改变载波信号相位
        + ==正交振幅调制QAM==：ASK和PSK结合，==数据传输率R=$B\log_2(mn)$==，B为叠加信号波特率，m个相位，每个相位n种振幅
    + ==模拟数据编码为数字信号==：用于 ==**脉码调制PCM**==，即对音频信号编码
        + 采样：奈氏准则，==采样频率大于等于最大频率的两倍==
        + 量化
        + 编码
    + 模拟数据调制为模拟信号：用于频分复用技术FDM、电话机和交换机、模拟声音数据
+ 电路交换、报文交换、分组交换
    + ==电路交换==：如传统通电话网络，适合数据量大且传送时间远大于呼叫事件。==**时延最小**==，有序，实时性强，适用范围广，但连接建立时间长，线路独占，利用率低，==**不能控制差错**==
        + ==连接建立==：建立一条专用、独占的物理通信路径。可能经过多个结点，但没有存储转发
        + ==数据传输==
        + ==连接释放==
    + ==报文交换：每段链路传输整个报文==，如早期电报通信。用户数据封装为报文，携带目标地址、源地址，使用存储转发。无需建立连接，动态分配线路，只在不同时间分别占用一段线路，提高线路利用率，但存储转发==**时延大**==，对报文大小无限制导致不可控
    + ==分组交换：将数据分成固定大小的较短数据块组成分组==，分组携带目标地址、源地址。无需建立连接，线路利用率高，减少出错重发数据量，简化存储管理，==**分组减少了时延**==，但附加信息开销大，无连接的数据报可能失序
        + ==**无连接的数据报**==：不保证可靠性，不一定有序，携带源地址和目的地址，==**应对故障能力强**==，资源利用率高，排队等待存储转发带来时延
        + ==**面向连接的虚电路**==：建立逻辑上的虚电路，==无需路由选择==，不携带目的地址而是虚电路标识符，开销小，但需建立、传输、释放三个过程，建立耗时，==不是一直占有线路，且一条物理线路可以有多条逻辑虚电路==，虚电路出现故障破坏巨大
+ 常用公式总结：所有公式都是比波转换、奈氏和香农的变形。频率单位Hz，波特率单位Baud，比特率单位b/s
    + ==比特率波特率转换：$比特率=波特率*\log_2n$，n为一个码元离散值个数，**注意等号左右顺序**==
    + ==无噪声求极限码元传输率：奈氏准则$极限码元传输率=2W$==
    + ==无噪声求极限数据传输率：奈氏准则$极限数据传输率=2W\log_2n$，W为无噪声低通信道带宽(Hz)，为n为一个码元离散值个数==
    + ==**有噪声求极限数据传输率：$min\{奈氏准则，香农定理\}$**==
    + ==香农定理：$极限数据传输率=W\log_2(1+信噪比值S/N)$，W为信道带宽(Hz)，信噪比值S/N为比值==
    + ==信噪比求信噪比值：$信噪比S/N(dB)=10·\log_{10}(信噪比值S/N)$==
    + ==正交振幅调制QAM：$R=B\log_2(mn)$，B为叠加信号**波特率**，m个相位，每个相位n种振幅，R为数据传输率(b/s)，即为比波转换的变形==
    + ==PCM求极限数据传输率：$极限数据传输率=2*(采样频率/2)*\log_2n$==
    + ==以太网：波特率=2*比特率：以太网用曼彻斯特编码，每个码元中有电平跳变，即1个数据2个跳变==

## 传输介质（传输媒体）及其特性：在第0层，物理层之下
+ 双绞线：绞合减少对相邻导线的电磁干扰。铜丝粗细和距离决定带宽。距离远时，模拟传输需要放大器，数字传输需要中继器。便宜
    + ==非屏蔽双绞线UTP==
    + ==屏蔽双绞线STP==：双绞线外加上金属丝编织的屏蔽层，抗电磁干扰
+ 同轴电缆：内导体、绝缘层、网状编制屏蔽层、塑料外壳。半双工，==屏蔽性==和抗噪声性更好，因此更快，较贵
    + 50$\Omega$同轴电缆（基带同轴电缆）：传送基带数字信号，用于局域网
        + 10BASE5使用的粗缆：数据率10Mb/s，长度500m
        + 10BASE2使用的细缆：数据率10Mb/s，长度200m
    + 75$\Omega$同轴电缆（宽带同轴电缆）：传送宽带模拟信号，用于有线电视
+ 光纤：纤芯、包层。带宽范围大
    + 多模光纤：光源为二极管，不同角度入射的多束光纤可以在一条光纤中传输，光的全反射。失真大，只适合近距离传输
    + ==单模光纤==：纤芯细，成本高。直径为一个光波长度，沿直线传播，==适合远距离传输==
+ 无线传输介质
    + 无线电波：向所有方向传播，穿透能力强，简化通信连接。用于手机通信，无线局域网WLAN
    + 视线介质
        + 微波：频率高，频段宽，沿直线传播，需要中继站
        + 红外线和激光：沿直线传播，需要先转换为各自信号（红外光信号、激光信号）

## 物理层接口特性
+ ==**机械**特性：引脚数目、规格==
+ ==**电气**特性：电压高低，传输速率==
+ ==**功能**特性：电平意义，信号线用途==
+ ==**规程**特性：时序关系，工作规程==

## 物理层设备：对象为信号
+ ==中继器（转发器）==：将==数字信号==整形并放大再转发，以消除噪声、失真、衰弱，==不能转发==。原理为信号==再生==，而非放大。中继器两端是相同速率、相同物理层协议的局域网，是网段而不是子网
+ ==集线器Hub==：多端口中继器，信号放大后发送到除输入端口外的其他所有端口，但不具有定向传送信号能力。半双工下工作。不能分割广播域和冲突域。物理上环状，逻辑上总线

## 零碎知识点
+ 曼彻斯特编码前后比特率相差两倍，完全消除直流分量
+ ==实现物理层互联，要求数据传输率相同，且物理层协议相同，但不要求数据链路层协议相同==
+ 放大器放大模拟信号，中继器放大数字信号
+ 粗缆以太网10BASE5：5个通信介质，4个中继器，3个通信介质可以挂接计算机

# 数据链路层

## 数据链路层功能和设计要点
+ 为网络层提供服务
    1. 无确认的无连接服务：用于实时通信或误码率较低的可靠通信信道，如**以太网**。出现错误由网络层处理
    2. 有确认的无连接服务：用于误码率较高的通信信道，如无线通信
    3. 有确认的面向连接服务：用于通信要求可靠性实时性较高的信道
    
    + 有连接一定有确认
+ 链路管理：面向链接服务中，链路建立、维持、释放过程
+ 帧定界、帧同步和透明传输
    + 帧定界：==对网络层分组添加**首部和尾部**封装为帧==，首部和尾部确定帧的界限
    + 帧同步：接收方从比特流中区分帧的起始和终止
    + 透明传输：解决数据中出现帧定界符的情况
+ 流量控制：在数据链路上的两结点中，限制发送方数据流量，使其发送速率不超过接收方接收能力，导致来不及接受的帧丢失
+ 差错控制：使发送方确定接收方是否正确接收数据
    + 位错：自动重传请求ARQ法，发送方数据帧附加CRC冗余校验码，接收方若发现错误则丢弃，发送发超时重传。否则返回确认信息
        + 检测：循环冗余校验CRC
        + 重传：自动重传请求ARQ
    + 帧错：帧丢失、重复、失序，用定时器和编号机制

## 组帧：解决帧定界、帧同步和透明传输的问题
+ 字符计数法：帧头部用一个计数字段标明帧内字符数（包含自己占用的1字节）。如果计数字段出错，灾难性后果
+ ==字符（字节）填充的首尾定界符法==：首位加入DLE STX和DLE ETX，如果数据中出现控制字符，再添加一个DLE，并由接收方收到后删除。注意DLE是一个字符。过于复杂
+ ==比特填充的首位标志法（零比特插入删除法）==：首位加入01111110，如果数据中出现==5个连续1后补一个0==，并由接受方收到后删除。由硬件实现，性能优于字符填充。HDLC协议使用
+ 违规编码法：物理层进行比特编码时，使用曼彻斯特编码没有用到的高-高和低-低电平。局域网IEEE 802采用

## 差错控制
+ 差错
    + ==随机差错：信道固有热噪声，通过提高信噪比可以降低影响==
    + ==突发差错：外界冲击噪声，无法通过提高信噪比避免==
+ 差错控制
    + 检错编码
        + 奇偶校验码：只能检测奇数个错误
            + 奇校验码：尾部添加1位，使所有1个数为奇数
            + 偶校验码：尾部添加1位，使所有1个数为偶数
        + ==循环冗余码（多项式码）==：检测n位错误，可以纠正
            + 对于k位数据M，有个n+1位生成多项式作为除数P，则最后结果为k+n位。先给M后添加n位0，再模二除法除以P（异或），得到n位余数作为CRC校验码比特序列，添加到M后即可。检测时对新的M+n位再除即可，余0正确，其他错误
    + 纠错编码
        + ==海明码==：可以发现双比特错，只能纠正单比特错
            + 编码：m位数据插入r位校验位组成m+r位，要求 ==$2^r\ge m+r+1$==。m+r位中，从1起编号，编号为2的幂次的位为校验位，将数据位展开为2的幂的和的形式，得到其相关的校验位。校验位满足和所有与其相关数据位一起异或，结果位0，可求出校验位。==检错d位，需要码距d+1==
            + 纠错：将每个校验位和所有与其相关数据位一起异或，结果从高到低反向排列得到的数即为错误的位编号。==纠错d位，需要码距2d+1==

## 流量控制
+ 原理
    1. 停止-等待原理：发送方发送一个帧就要等待接收方的应答信号；接收方收到一个帧，如果能接受下一帧，发送应答信号。每次只允许发送一个帧，效率低
    2. 滑动窗口原理：发送窗口大小$W_T$表示最多还可以发送多少数据帧。接收窗口大小控制可以接受哪些帧。发送端每收到一个确认帧，窗口前移1个帧；接收端收到窗口内的数据帧后，窗口前移1个帧，发回确认帧，否则丢弃
    + 接收窗口为1才能保证有序接收；窗口大小固定；接收窗口先滑动，发送窗口才有可能滑动
    
    3. 可靠传输机制：通过确认和超时重传完成
+ ==**停止-等待ARQ协议**==：==发送窗口=1，接收窗口=1==。==每次发送一个帧后等待==，接收方确认后返回==确认帧==，收到错误帧直接丢弃
    + 在发送方设置时器，应对接收方丢弃错误帧
    + 接收方若收到相同帧，丢且并再发送一个确认帧，以防第一个确认帧丢失
    + 发送和接收方都设置缓冲区，处理重发
+ ==**后退N帧ARQ协议GBN**==： ==发送窗口$W_T\le 2^n-1$，接收窗口=1== ，n为帧编号所占的比特数。接收方确认后返回==确认帧==，收到错误帧直接丢弃
    + 接收方只按顺序接收帧，对 ==**返回第n个帧的确认帧表明n及以前的帧都收到**==，且不必对每个帧都返回确认帧
    + 发送方可以连续发送
    + 若信道误码率大，效率不如停止-等待协议，==**需要重传错误帧和之后所有帧**==
+ ==**选择重传ARQ协议SR**==：==接收窗口=发送窗口=$W_{Tmax}=W_{Rmax}=2^{n-1}$==，n为帧编号所占的比特数。接收方确认后返回==确认帧==，收到错误帧返回否定帧NAK，==**可无序**==
    + 接收方设置缓冲区，大小等于窗口大小
    + 无需重传未按序正确收到的帧

## 信道指标
+ ==信道效率（信道利用率）：发送方在一个发送周期（从发送到收到确认帧）内，有效发送数据时间占总时间的比率==
    + 最大信道利用率
        + 在停止-等待里，如果不考虑确认帧发送时间，==即$信道利用率=\frac{帧长/数据传输率}{2*传播时间+帧长/数据传输率}=发送时延/总时间$==，==而不是传播时延/总时间==
        + 在后退N帧里，由于可以连续发$2^n-1$个，==只需在第一条上乘以$2^n-1$==
        + 在重传里，由于可以连续发$2^{n-1}$个，==只需在第一条上乘以$2^{n-1}$==
+ 信道吞吐率=信道利用率\*发送方发送速率

## 介质访问控制
+ 介质访问控制：为使用介质的每个结点隔离来自同一信道上其它结点传送的信号，在==介质访问控制MAC子层==上
+ 方法
    + ==信道划分==：静态划分，将广播信道变为点对点信道，共享时间或空间
        + 多路复用技术：把多个信号组合在一条物理信道上传输，即将物理信道逻辑上分为多条信道，提高信道利用率
            + 频分多路复用FDM：多路基带信号调制到不同频率载波上，中间插入保护频带，每个子信道带宽可不相同。充分利用传输介质的带宽，系统效率高，适合模拟信号
            + 时分多路复用TDM：切时间片，轮流分配给多个信号。由于数据突发性，信道利用率低，适合数字信号
            + ==统计时分多路复用（异步时分多路复用）STDM==：TDM的改进，按需==动态==分配时隙，提高线路利用率
            + 波分多路复用WDM：光的频分多路复用
            + 码分多路复用CDM：用不同编码区分信号，同时共享时间和空间。频谱利用率高、抗干扰能力强、语音质量好、成本低。用于无线通信
                + ==码分多址CDMA(Code Division Multiple Access)==：每个信号写成码片（是1和-1组成的向量），要求信号之间码片正交。发送数据1即发送码片向量，发送数据0即发送码片向量的反。各信道码片叠加（相加）。分离时，用每个码片乘以叠加后的码片，得到发送数据为1或0
            + 正交频分复用：无线局域网WLAN使用
    + 随机访问（争用型协议）：动态划分，所有用户争用信道
        + ALOHA协议
            + ==纯ALOHA协议==：发送时==不用检测==，一段时间未收到确认则发生了冲突，等待一段时间后重发。吞吐量低，==吞吐量=0.184\*带宽==
            + ==时隙ALOHA协议==：各个站时间同步，==划分时隙，规定只能在时隙开始时发一个帧==。减少冲突，增加信道利用率，吞吐量是纯ALOHA两倍，==吞吐量=0.368\*带宽==
        + ==载波侦听多路访问CSMA(Carrier Sense Multiple Access)== 协议
            + ==1-坚持CSMA：忙则等待，空闲必发，发生冲突后等待一段后重发==，及时抢占信道。==**以太网使用**==
            + ==非坚持CSMA：忙则放弃，**随机**时间后重新侦听，空闲必发==。降低同时发送冲突，但延迟增加
            + ==p-坚持CSMA：时分信道中，**忙则放弃到下一个时隙**，空闲以**p概率**发送==。减少延迟，减少冲突
        + ==载波侦听多路访问/碰撞检测CSMA/CD(Collision Detection)== 协议：先听后发，==边听边发（碰撞检测）==，冲突停发，随机重发。适用于总线型或半双工的有线局域网，不能用于无线局域网（检测花费大，存在隐蔽站问题）
            + ==争用期（冲突窗口、碰撞窗口）为$2\tau$=2\*总线传播时延==，即最多争用期时间就会知道是否碰撞，超过争用期则一定未碰撞
            + ==**最小帧长=$2\tau$\*数据传输率**==，小于最小帧长的帧直接丢弃，才能实现在传输前最小帧长大小的数据时已经占领信道，此后不会再冲突
            + ==二进制指数退避算法：解决碰撞问题。对于第k次重传，**退避时间$2\tau*l$，若$k<10$，$l<2^k-1$。若$k\ge10$，$l<2^{10}-1$，若k=16后还不成功，放弃**==
        + ==载波侦听多路访问/碰撞避免CSMA/CA(Collision Avoidance)== 协议：适用于 ==**无线局域网**==，不能完全避免碰撞。无法边听边发，信道由忙变空闲时，需要发送帧的站都要等待 ==**随机退避**== 时间。发送后告诉其他结点，防止碰撞
            + 预约信道：发送方发送时，同时其他站点自己将占用信道的时间，防止碰撞
            + ACK帧：==**接收方接收后，返回ACK帧**==
            + RTS/CTS帧：可选，信道预约方法，碰撞避免机制，解决隐蔽站问题
    + 轮询访问：动态划分。监控站循环轮询结点，一次分配一个信道。适合同时发送数据概率很大的信道
        + ==令牌传递协议==：站点希望发送帧，需要等到令牌。有了令牌后，启动发送，其他站点都必须转发。到达目的站后，给帧尾部设置相应比特，指示已经收到，并继续转发，知道帧回到始发站，始发站撤销帧，释放令牌，令牌继续在环形网上游荡。注意环形网物理上总线，逻辑上环状。不存在冲突，但持有令牌时间也有限制

## 局域网LAN：==物理层和数据链路层==
+ 分类
    + 以太网：物理拓扑是星形结构，逻辑拓扑是总线结构
    + 令牌环：物理拓扑是星形结构，逻辑拓扑是环形结构
    + ==FDDI光纤==分布数字接口：物理拓扑是双环结构，逻辑拓扑是环形结构
+ 以太网和IEEE802.3
    + 无确认
    + IEEE 802.3标准：数据链路层分为逻辑链路控制子层LLC和介质访问控制子层MAC，分别对接物理层和网络层
    + 信息以广播形式发送，每台（包括发送的结点）计算机必须处理每个广播信息，降低网络性能
    + 介质访问控制方式：==CSMA/CD==
    + 基带传输（数字信号）
    + 简化通信：
        + 无连接的无连接服务
        + 不对数据帧编号，不要求接收方返回确认帧
    + 传输介质：第一个10为数据率10Mb/s，BASE为基带传输（数字信号），5和2为长度500m和200m，==T为双绞线，F为光纤==
    
    | 参数     | 10BASE5      | 20BASE2      | 10BASE-T             | 10BASE-FL    |
    | -------- | ------------ | ------------ | -------------------- | ------------ |
    | 传输媒体 | 粗同轴电缆   | 细同轴电缆   | 非屏蔽双绞线UTP      | 光纤对       |
    | 编码     | 曼彻斯特编码 | 曼彻斯特编码 | 曼彻斯特编码         | 曼彻斯特编码 |
    | 物理拓扑 | 总线形       | 总线形       | 星形（由于有集线器） | 点对点       |
    
    + 网卡：工作在物理层和数据链路层
    + ==MAC地址（物理地址）：6字节48位，冒号16进制，如02-6-8c-e4-b1-21==
    + MAC帧：==前导码8B==，没有帧结束符，==首部+尾部18B==
        + 帧长64B-1518B，==数据46B-1500B==（均不包括前导码）==即IP数据报总长度最少46B，最多1500B==，目的地址6B
        + ==CRC校验首部和数据==，不校验前导码
    + 高速以太网：速率超过100Mb/s
        + 100BASE-T：100Mb/s，半双工或全双工
        + 吉比特以太网：1Gb/s，半双工或全双工
        + ==10吉比特==以太网：10Gb/s，使用==光纤==，全双工，不适用CSMA/CD
+ IEEE 802.11：无线局域网WLAN
    + ==数据帧：地址1为BSS内的接入点AP地址，地址2为源地址，地址3为BSS通过AP根据802.3连接的路由器的端口地址==
    + 介质访问控制方式：==CSMA/CA==
    + 分类
        + 有固定基础设施无线局域网：==基本服务集BSS==包括一个基站（==接入点AP==）和若干移动站，BSS内部站直接通信，和BSS外的站通信需要经过接入点AP。AP和路由器相连，即为802.3
        + 无固定基础设施无线局域网自组织网络：没有接入点
+ 令牌环网
    + 环接口干线耦合器TCU：连接电缆和每一站，传递所有经过的帧，为发送接收数据提供接口
    + 无碰撞

## 广域网WAN：==物理层、数据链路层和网络层==
+ 连接广域网各交换机的链路：高速链路，数据发送速率高，即发送时延短
+ 互联网=局域网+路由器+广域网
+ ==点对点PPP协议（Point-to-Point Protocol）==：面向 ==**字节**，字节填充（默认）或比特填充（SONET/SDH线路上）==。点对点，不用CSMA/CD。==不用序号或确认机制==，==有连接，不可靠==。==全双工==。两端可以运行不同网络层协议，==不具有流量控制==，可crc检测错误，不能纠错
    + 组成
        + 链
        + 网络控制协议NCP：配置网络层协议
        + 将IP数据报封装到串行链路方法：IP数据报长度受最大传输单元MTU限制
    + PPP帧
        + 信息段0B-1500B
        + 有协议段，0x0021表示信息字段为IP数据报
+ ==高级数据链路控制HDLC协议（High-level Data Link Control）==：面向 ==**比特**，比特填充==。使用编号和确认机制，==可靠==。全双工
    + 站
        + 主站：控制链路，发出命令帧
        + 从站：受控于主站，发出响应帧
        + 复合站：平等
    + 基本配置
        + 非平衡配置：主站、从站
        + 平衡配置：链路两端都是复合站
    + 数据操作方式
        + 正常响应方式：非平衡，从站必须收到主站许可再响应
        + 异步平衡方式：平衡
        + 异步响应方式：非平衡，从站无需收到主站允许也可以传输
    + HDLC帧
        + 控制字段
            + ==信息帧==I：0x，用来传输信息或使用捎带技术对数据确认
            + ==监督帧==S：10，流量控制、差错控制
            + ==无编号帧==U：11，控制链路建立拆除

## 数据链路层设备：对象为帧
+ ==网桥==：连接多个以太网，成为更大的以太网，==**隔离冲突域（即可以正确转发）**==，对网络隔离和分段。一次只能执行一个帧的转发，端口连接网段处理对象为帧，根据MAC地址转发。网桥两侧的数据链路层协议可以不同。只适用于用户数量不多和通信量不大的局域网，否则因传播过多的广播信息产生拥塞，即广播风暴
    + ==透明网桥==：接收与之连接的所有LAN传送的每一帧，因此选择的==不是最佳路由==
        + 达到帧的处理
            + 源LAN和目的LAN相同：丢弃
            + 源LAN和目的LAN不同：转发
            + 未知源LAN：扩散
        + ==自学习算法==：站A发出帧从某端口进入网桥，则到站A的帧可以从这个端口发出，逐渐建立转发表，即==根据**源MAC地址**学习==
        + 生成树算法：保证每个源到目的地只有唯一路径
    + ==源路由网桥==：发送帧的源站==选择最佳路由==（时间最短），网桥只是根据信息接收和转发。发现帧数量指数增加，网络拥塞，但负载均衡
        + 源路由生成过程：未知路径时，源站发送发现帧，从多个途径到达目的站后，目的站一一发送应答帧，每个应答帧原路径返回，网桥将自己的标志记录在应答帧。源站选出最佳路由，此后帧首部携带路由信息
+ 局域网==交换机==：多端口的透明网桥。可用于实现虚拟局域网VLAN。每个端口直接与主机相连。全双工。独占带宽（总带宽和每个用户带宽由的x和x/N变为nx和x），多对用户同时通信。比网桥快
    + 直通式：只检查目的地址。速度快，安全性差，不支持速率不同端口的交换
    + 存储转发式：缓存在高速缓存器中后，检查数据正确再转发，否则丢弃。可靠性高，支持速率不同端口的交换，延迟大

## 零碎知识点
+ 数据链路层主要作用是将物理层可能出错的物理连接改造为逻辑上无差错的数据链路
+ 以太网最小帧长=64B。以太网最长帧长1518字节，其中18字节为前导码。Hub为5BaseT，即双绞线，传输速率100Mb/s
+ 二进制退避题：
    + 下一次重传成功概率：k越大成功概率越大
    + 发送成功概率：总概率，首次为1/2，冲突一次后为1/4，k越小概率越高
+ 无线局域网发生碰撞后也要发送完毕整个帧。有线局域网发生冲突立即停止发送
+ 路由器在多个网络构成的互联网中转发分组，即连接广域网和局域网；==结点交换机在单个网络中转发分组==
+ ==广域网采用存储转发，局域网采用广播==
+ 网桥和交换机由硬件控制帧转发，时延小于路由器

# 网络层

## 网络层功能：在任意结点间进行数据传输，不保证可靠
+ 异构网络互联：连接数据链路层协议和物理层协议均不同的网络
    + 中继系统
        + 物理层：中继器、集线器
        + 数据链路层：网桥、交换机
        + 网络层：路由器
        + 更上层：网关
+ 路由和转发：路由器最主要功能，根据路由表转发；路由表通过路由算法得到
+ 拥塞控制
    + 判断拥塞：随着网络负载增加，网络吞吐量小于正常吞吐量：轻度拥塞；吞吐量随负载增大而减小：拥塞；负载继续增大，吞吐量为零：死锁
    + 拥塞控制
        + 开环控制：设计网络时，考虑周到，系统启动后不再修改，静态预防方法
        + 闭环控制：是先不考虑拥塞因素，系统启动后及时检测和解决，动态方法

## 路由算法
+ 和数据链路层关系：网络层用IP地址完成寻址，路由器根据路由表选择到目标网络需要转发到的下一跳，IP分组多次转发后到达目标网络，在局域网中通过数据链路层MAC地址以广播方式寻址
+ 分类
    + 根据能否自适应
        + 静态路由算法（非自适应路由算法）：网络管理员手动配置路由信息，用于军事系统和较小商业网络
        + 动态路由算法（自适应路由算法）：路由器之间彼此交换信息，不断更新
            + ==距离-向量路由算法==：所有结点定期将==到所有**结点**的路由选择表传给**相邻**节点==
                + 路由选择表：目的地+代价（距离）
                + 更新路由选择表条件：新路由或代价更小的路由
                + 常见距离-向量算法：RIP协议
                + 通信子网越大，更新报文越大
                + ==慢收敛==
            + ==链路状态路由算法==：所有结点用==泛洪法将自己和**相邻**结点的费用给所有**结点**==，具有完全的网络拓扑信息，用Dijkstra算法求最短路径
                + 任务：主动测试所有相邻结点状态；定期将链路状态传播给其他所有结点
                + 更新网络拓扑和状态视野图条件：链路状态发生变化后，其他结点发来的链路状态报文到达
                + 常见链路状态算法：OSPF协议
                + 路由器链路状态和互联网规模无关，可用于大型互联网环境
    + 根据自治系统范围
        + 内部网关协议IGP（域内路由选择协议）：一个自治系统内的协议，如RIP、OSPF
        + 外部网关协议EGP（域间路由选择协议）：自治系统之间路由选择协议，如BGP
+ 路由器交付
    + 直接交付：==同一网段内，不经过路由器，直接交付==
    + 间接交付：不同网段内，要经过路由器，最后再加直接交付
+ 层次路由：
    + 互联网划分自治系统，每个自治系统包含多个局域网，有权自主决定本系统内路由选择协议，防止路由表过大
    + OSPF算法将一个自治系统再划分为很多区域，路由器看不到其他区域内部

## IP协议：无连接，不可靠
+ IPv4分组
    + ==IP分组：首部+数据。首部包含20B固定部分和长度可变的可选字段，固定部分中，首部长度（单位为**4B**），总长度（单位为**1B**），指示分片后顺序的片偏移占13位（单位为**8B**），生存时间TTL，协议（2为组播数据报，6表示TCP，17表示UDP，89为OSPF报文）==
    + IP数据报分片：网络层IP数据报总长度==大于数据链路层要求的最大传送单元MTU时，由**中间路由**将IP数据报中的数据分装在片中，由**目的端系统**重组==。来自同一IP数据报的片，标识相同。3位标志第一位无意义，==标志DF（dont fragment）=0表示允许分片，标志MF（more fragment）=0表示后面没有分片==
        + 分片计算：IP数据报长度-20B=数据长度；MTU-20B=最大数据长度；在满足除最后一个片外，==都8B倍数前提下==，划分数据，片长度为新的数据长度+20B

## IPv4地址
+ IPv4地址$\{<网络号>，<主机号>\}$
    + ==4字节32位，点分十进制==，如127.0.0.1
    + 分为5类
        + ==A类**1-126**：0+7位网络号+**24位主机号**==，网络号$2^7-2$个（网络号全0为本网络，==网络号127为环路自检==），主机号$2^{24}-2$个（==主机号全0为本网络，主机号全1为本网络广播地址==）
        + ==B类**128-191**：10+14位网络号+**16位主机号**==，网络号$2^{14}-1$个（网络号全0为本网络），主机号$2^{16}-2$个（==主机号全0为本网络，主机号全1为本网络广播地址==）
        + ==C类**192-223**：110+21位网络号+**8位主机号**==，网络号$2^{21}-1$个（网络号全0为本网络），主机号$2^8-2$个（==主机号全0为本网络，主机号全1为本网络广播地址==）
        + ==D类**224**==-239：1110+28位==多播==地址（==组播==）
        + E类240-255：1111+28位保留为今后使用
    + 包括网络号+主机号，网络号在因特网中唯一，主机号在该网络号网络中唯一
    + 主机号为0为网络本身
    + ==主机号为**1**为本网络广播地址==
    + 127.0.0.1为环路自检时的任意主机本身
    + 32位全0为本网络上本主机
    + 32位全1为整个TCP/IP网络广播地址
+ IPv4地址特点
    + 路由器只根据网络号转发分组
    + 路由器至少有2个IP地址，每个端口至少一个
    + 转发器或网桥不能划分广播域，其连接的网络网络号相同
+ ==网络地址转换NAT==：专用网络地址转换为公用地址，从而隐藏内部IP地址
    + 局域网私有IP地址：可重用，目的地址为私有IP地址的数据报路由器不与转发
        + A类1个网段：==**10**==.0.0.0-10.255.255.255
        + B类16个网段：==**172.16**==.0.0-172.==31==.255.255（==不是127==）
        + C类256个网段：==**192.168**==.0.0-192.168.255.255
    + NAT路由器有NAT转换表，将本地地址和全球地址互相转换，格式为$\{本地IP地址:端口\}和\{全球IP地址:端口\}$，可以让多个私有IP地址映射到同一全球地址

## 子网划分
+ 子网划分$\{<网络号>，<子网号>，<主机号>\}$
    + 借用==主机号==，增加一个子网号字段。网络号不变
    + 剩余主机号在全0或全时依然不能被指派，分别表示子网网络号和子网广播地址
+ 子网掩码
    + 网络号和子网号都为1，主机号都为0，即网络地址=网络号+子网号=IP地址&子网掩码
+ 路由器分组转发算法：路由表中包括目的网络地址、子网掩码、下一跳地址
    + 从分组首部提取目的IP地址D
    + 判断是否为直接交付：对路由器直接相连的网络的子网掩码和D与
    + 不能直接交付时，查找路由表中目的地址为D的特定主机路由，转发分组给下一跳路由器
    + 路由表中没有特定主机时，对路由表中每一行的子网掩码和D与，若和目的网络地址相同则转发
    + 都不相同，则发送给默认路由
    + 没有默认路由，报告转发分组出错
+ ==默认网关ip地址：一般为子网第一个ip地址==

## CIDR
+ 无分类域间路由选择CIDR
    + 消除ABC类地址概念，IP地址为$\{<网络前缀>，<主机号>\}$记为“IP地址/网络前缀位数”
    + 全0全1主机号不使用
    + CIDR地址块：网络前缀相同的连续IP地址
    + ==路由聚合、构成超网：将CIDR地址块的IP地址合并==
    + CIDR若想分子网，也要从主机号里借
    + CIDR意义：提高IP地址空间利用率，减少路由器路由表大小，提高路由转发能力
+ CIDR下路由器分组准发：路由表中由网络前缀和下一跳地址。如果匹配多个结果，取路由前缀==最长==最具体的路由

## ==地址解析协议ARP（Address Resolution Protocol）：完成IP地址到MAC地址映射==
+ 每台主机有==ARP高速缓存==，==存放ARP表==，内容为 ==**本局域网内**主机和路由器的IP地址到MAC地址映射==
+ 过程：
    + 主机A欲向==本局域网==上主机B发送IP数据报，先在其ARP高速缓存中查看有无主机B的IP地址
    + 若有，则将映射的MAC地址写入MAC帧，发送MAC帧
    + 若没有，将目的MAC地址为==FF-FF-FF-FF-FF-FF==、数据为 ==**ARP请求分组**的MAC帧**广播**== 到本局域网所有主机，主机B收到后，将其IP地址和MAC地址映射关系通过 ==**ARP响应分组**以**单播**== 形式发给A，A收到后更新ARP缓存，发出MAC帧
    + 若B在==另一局域网==内，A将ARP请求分组发给本局域网路由器。e.g.A给B发，经过5个路由器，则使用了6次ARP协议

## ==动态主机配置协议DHCP（Dynamic Host Configuration Protocol）：给主机动态分配临时IP地址==，应用层协议，==基于UDP==
+ 使用客户/服务器方式：
    + 需要IP地址的主机广播“发现报文”，==源ip地址为0.0.0.0（由于还没有IP地址），目的ip地址为255.255.255.255（由于不知道DHCP服务器的IP地址）==，只有DHCP服务器可以回复
    + DHCP服务器在数据库中找该计算机配置信息，找到则返回信息，找不到则在IP地址池中分配一个，广播“提供报文”，包含IP地址和相关信息
    + 主机收到后，如果接收提供的参数，广播“请求报文”
    + DHCP服务器收到后，广播“确认报文”，分配IP
+ 由于是临时IP地址，有租用期

## ==网际控制报文协议ICMP（Internet Control Message Protocol）：主机或路由器报告差错和异常==
+ ICMP报文是IP数据报的数据，需要加上IP数据报首部组成IP数据报
+ 分类
    + ICMP差错报告报文：特例：==对ICMP差错报告报文不再发送ICMP差错报告报文，分片的数据报片只对第一片发送，组播数据报不发送，特殊地址（0.0.0.0，127.0.0.0）数据报不发送==
        + 终点不可达
        + ==源点抑制：要求源点降低发送速率，以应对拥塞或丢弃数据报==
        + ==超时==
            + ==路由器收到的数据报生存时间TLL为0时，丢弃，向源点发送超时报文==
            + ==路由器在规定时间内没有收到全部数据报片，丢弃所有，向源点发送超时报文==
        + 参数问题：字段值不正确，丢弃，发送参数问题报文
        + 改变路由（重定向）：让主机知道下一应将数据报发给其他路由
    + ICMP询问报文
        + ==回送请求和回答报文：PING==
        + 时间戳请求和回答报文
        + 掩码地址请求和回答报文
        + 路由器询问和通告报文

## IPv6
+ 解决IP地址耗尽方法
    + 采用无类别编制CIDR
    + 采用网络地址转换NAT
    + ==采用更大地址空间IPv6（根本上解决）==
+ IPv6地址
    + ==16字节128位冒号16进制==，即IPv4的4字节的平方。如4BF5:0:0:0:BA5F:39A:A:2176，简写为4BF5::BA5F:39A:A:2176
    + ==不允许分片==，过长直接丢弃，发送ICMP报文。首部长度不可变
    + ==简化头部字段数目，没有检验字段==
    + 目的地址
        + 单播
        + 多播
        + 任播：目的地址为一组地址，但只交付给距离最近的一个
+ IPv4向IPv6过渡
    + 双协议栈：一部分主机或路由器同时装有IPv4和IPv6协议
    + 隧道技术：将整个IPv6数据报封装到IPv4数据报数据中

## 路由协议
+ 自治系统AS（Autonomous System）：AS内部有统一路由选择协议（内部网关协议IGP），AS之间也有路由选择协议（外部网关协议EGP）
    + ==内部==网关协议IGP（Interior Gateway Protocol）：自治系统内部的路由选择协议，如==RIP和OSPF==
    + ==外部==网关协议EGP（External Gateway Protocol）：自治系统之间的路由选择协议，如==BGP-4==
+ ==路由信息协议RIP（Routing Information Protocol）==：==应用层UDP==协议，基于距离-向量的内部网关协议。简单，收敛快，但限制规模为15，路由表交换开销大，出现故障有慢收敛现象（坏消息传得慢）
    + 每个路由器==维护自己到其他**每个**目的网络距离==
    + 每通过一个路由器，跳数加1，跳数最少的路径优先
    + ==最多15跳，16跳时网络不可达==
    + ==**相邻**路由器==按固定时间间隔广播一次RIP路由，动态维护路由表
    + RIP中子网掩码必须相同，RIP2中无需
    + ==慢收敛，坏消息传播慢==
    + ==**距离-向量算法**==：路由表<目的网络N，距离d，下一跳路由器X>
        + ==收到路由器X发来的RIP报文后，对报文下一跳全部换为X，距离d+1==
            + ==如果目的网络N不在本路由器路由表中，加入==
            + ==如果N在，下一跳为X，更新==
            + ==如果N在，下一跳不为X，取距离最小者==
        + 180s没收到相邻路由器RIP报文，记为距离16，不可达
+ ==开放最短路径优先协议OSPF==：网络层协议，用==IP数据报==传输，协议字段为89。基于==链路状态路由算法==的内部网关协议。灵活，任何一个路由知道全网的网络结构
    + 以==泛洪法==向本自治系统 ==**所有**路由器==发送信息
    + 信息内容为和 ==**相邻**路由器==的链路状态
    + 只有链路状态变化才发送信息，坏消息也收敛的很快
    + 多条代价相同路径存在时，通信量分配，即多路径间的负载平衡
    + 子网掩码可以不同
    + 选择代价最低路径
    + 使用问候分组（HELLO）保持和其他邻居连接
    + 得到全网的拓扑结构图后，根据Dijkstra算法求最短路径中的下一跳，构造路由表
    + OSPF将一个自治系统分为多个区域，泛洪法范围缩小，较小通信量
+ ==边界网关协议BGP（Border Gateway Protocol）==：应用层==TCP==协议，基于==路径-向量（不是距离-向量）==
    + 因特网太大，不找最佳路由，只找能到达目的路由
    + 每个自治系统选择至少一个路由作为==BGP发言人==，和其他自治系统中的BGP发言人建立TCP连接，交换BGP报文
    + 结点数少
    + 子网掩码可以不同
    + 和相邻站交换全部路由表（同RIP）。发生变化时再更新，只更新有变化部分（同OSPF）
    + 与RIP和OSPF不同，==BGP知道路径==，而不只是下一跳

## IP组播（多播）
+ 组播：源计算机==一次发送**单个**分组==，抵达用一个组地址标识的若干目标主机，==将副本发送给每个主机==
    + 因特网组管理协议IGMP：主机加入组播组
    + IP组播地址：D类1110，范围224-239
    + 组播数据报：协议字段为2
    + 不提供可靠交付，对组播数据报==不产生ICMP差错报文==
    + IP地址求组播MAC地址：组播基础地址01-00-5E-00-00-00，只后23位可修改。32位IP地址取后23位，改为16进制，填充进去
+ ==因特网组管理协议IGMP（Internet Group Management Protocol）==：TCP/IP，让组播路由器知道本局域网上是否有主机参加或退出某个组
    + 当主机要加入新的组播组，向组播地址发送IGMP报文
    + 组播路由器需要周期性探寻给本地局域网上主机是否仍是组成员
+ 组播路由选择算法：找到以源主机为根节点的转发树
    + 链路状态
    + 距离向量
    + 协议无关组播PIM

## 移动IP
+ 功能实体
    + 移动结点：具有永久IP地址的移动结点
    + 移动代理
        + 归属代理（本地代理）：在归属网络中执行移动管理，采用隧道技术
        + 外埠代码（外部结点）：在外部网络中执行移动管理
+ 移动IP通信：
    + 移动结点在本地网络，用本地地址通信
    + ==移动结点到外地网络，申请一个转交地址，通知**本地**代理，保留本地地址。通信时使用转交地址，本地代理和外部地址之间有隧道，由本地代理发给外部代理，外部代理发给转交地址==

## 网络层设备：路由器（网关）
+ ==分割冲突域和**广播域**==
+ 源主机发送数据报
    + ==直接交付：同一网络，不经过路由器==
    + 间接交付：不同网络，经过路由器
+ 功能
    + 路由选择
    + 分组转发
+ 网桥和高层协议无关，但路由器是面向协议的
+ 路由表：目的网络IP地址、子网掩码、下一跳IP地址、接口
+ ==抑制广播风暴：抑制ARP，即可划分广播域的设备==
+ ==**路由选择处理机**负责计算路由信息==
+ 默认路由0.0.0.0/0

## 零碎知识点
+ IP协议不保证可靠
+ 路由器连接多个局域网，每个局域网只要求网络层以上的协议相同，网络层、数据链路层、物理层协议都可以不同
+ 最大传送单元MTU：数据链路层数据报能承载最大数据量
+ ==普通路由器转发IP数据报时不改变源IP地址和目的IP地址==。==在不同网络转发时，MAC帧的**源地址**和**目的地址**改变！！！！！==。==同一网络中网桥转发，MAC帧地址不改变。在NAT路由器中，要改变IP数据报源IP地址或目的IP地址==
+ 片偏移单位8B，因此==分片必须为8B倍数==
+ 一个子网掩码为255.255.255.0的网络，可知其最大主机数为$2^8-2$（全1全0），最大子网数$2{8-2}-2$（至少2台主机+主机号全1全0，占2位，还剩6位，排除子网号全1全0）
+ ==无论何时，主机号全1全0都不能分配==，子网号一般不分配全1全0，但随着CIDR使用，子网号全1全0也可
+ ==PING使用回送请求和回答报文==，Traceroute使用超过报文
+ ==IP数据报中检验字段只检查**首部**==
+ 解决IP耗尽问题最根本办法：IPv6
+ IPv6数据报太大时，由于不能分片，故丢弃，发送ICMP报文
+ ==存储转发设备实现ABC层，则在ABC层协议可以不同。如路由器：物数**网**协议都可以不同（注意是屏蔽下面层的差别），网桥：物**数**协议可以不同。但中继器不是存储转发设备，**物理层协议必须相同**==

# 传输层
+ 通信子网没有传输层和应用层，即路由器中没有，只有主机有。TCP报文段和UDP用户数据报对路由器不可见
+ 功能
    + ==提供**进程**之间端到端通信==（网络层为主机之间点对点通信）
    + 复用和分用
        + 复用：发送方不同进程用同一个传输层协议传输数据
        + 分用：接收方传输层在剥去报文首部后正确交付给目的进程
    + ==差错检测：首部和**数据**部分==
    + 提供两种传输协议：面向连接的TCP（可靠）和无连接的UDP（不可靠）
+ 端口：识别的是进程，==TCP和UDP分别有自己的端口号==，互不干扰
    + 作用：传输层服务访问点SAP，应用层通过端口将数据交付传输层，传输层通过端口将数据交付应用层
    + ==端口号：16bit，熟知**端口号20FTP数据连接，21FTP控制连接，23TELNET远程控制，25SMTP，53DNS，80HTTP，110POP3**==
        + 服务端使用的端口号：0-1023熟知端口号，1024-49151登记端口号
        + 客户端使用的端口号：49152-65535
    + ==套接字=（主机IP地址，端口号）==，唯一标识网络中一台主机和其上一个应用
+ 面向连接服务和无连接服务
    + 区别
        + 面向连接服务：通信前建立连接、通信时被监控和管理、通信后释放连接
        + 无连接服务：尽力传送
    + 传输控制协议TCP：面向连接，提供全双工可靠逻辑信道。开销大，适用于可靠性重要场合，如==文件传输协议FTP，**超文本传输协议HTTP**，远程登陆TELNET==
    + 用户数据报协议UDP：无连接，提供不可靠逻辑信道。无需确认，速度快，实时性好，如==小文件传送协议TFTP，**DNS**，SNMP，实时传输协议RTP==

## 用户数据报协议UDP：==无连接、不可靠==
+ 只在IP数据包服务基础上加上复用分用和差错检测，面向报文，UDP数据报不可分
+ UDP数据报：
    + ==**首部8B**==，源端口、目的端口、UDP长度、UDP校验各2B
    + 端口号不正确时，丢弃，发送ICMP差错报文
+ UDP校验：可以不使用，不校验时校验字段全0
    + ==**首部和数据都校验**==，在首部前添加12B伪首部（伪首部不发送），这样既校验了UDP数据报，又校验了IP数据报的源IP地址和目的IP地址
    + 校验过程：添加伪首部，将全0放入校验字段，把UDP数据报堪称16位字的拼接，不足时末尾补0，对每个16位字求反码，所有字求和，对和取反码，写入校验字段；检查时，添加伪首部，对每个16位字取反码，所有字求和，无差错时为1，否则丢弃

## 报文段TCP：==面向连接、可靠==
+ 可靠，全双工，面向连接，服务器易收到泛洪攻击
+ TCP报文段：
    + ==首部固定长度+可变长度，**固定长度20B**==。
    + ==序号字段seq==，**4B**，即==当前报文段数据第一个字节的序号==
    + ==确认号字段ack==，**4B**，即==期望对方下一个报文段携带的序号==。如A给B发送报文段的序号字段301，数据共100B，则该报文段数据为301-400，B给A发送的确认报文段中序号字段应为401，表示401以前的都已经收到
    + ==**数据偏移**4位，单位是**4B**，表示**首部长度**==
    + ==同步位SYN、确认位ACK，连接请求报文SYN=1，ACK=0；连接接收报文SYN=1，ACK=1；其他报文SYN=0，ACK=1==
    + ==终止位FIN=1，表示发送完毕，要求释放传输连接==
    + 复位位RST=1，连接出错，要求释放连接，再重新建立连接
    + 推送位PSH=1，要救尽快交付给应用进程，而不等待缓存填满
    + 紧急位URG=1，报文段中有紧急数据，要尽快传送
    + ==窗口字段2B==，如确认号701，窗口字段1000，即发送方还能接收701-1700
    + 校验和，同UDP（只有协议字段不一样，UDP为17，TCP为6）
    + 紧急指针字段：数据中前多少B时紧急数据
    + 选项字段：长度可变，包含最大报文长度MSS，表示数据字段最大长度
+ TCP连接管理
    + TCP连接的端点：套接字=IP地址+端口
    + 客户\服务器方式
    + ==TCP连接的建立：**三**次握手==。由于没有数据，每次ack都是上次seq+1。每次seq都是上次ack。前两次握手都==消耗一个序号但没有数据==，即==TCP报文中的序号和确认号都有一个实际是没有数据的==。最后一次可以有数据可以没有
        + 客户机向服务器发送连接请求报文段：不含应用层数据，==SYN=1，ACK=0，起始序号seq=x==
        + 服务器同意连接，分配缓存和变量，发回连接接收报文：不含应用层数据，==SYN=1，ACK=1，确认号ack=x+1，seq=y==
        + 客户机收到后，分配缓存和变量，再向服务器发出确认：==SYN=0，ACK=1，seq=x+1，ack=y+1==
    + ==TCP连接的释放：**四**次握手==：最短时间为1.5个RTT，即A给B发断开，B给A回时也给B发断开，A回复
        + 客户机向服务器发送连接释放报文段，关闭客户机向服务器发送的数据通路：FIN=1，seq=u
        + 服务器收到后，发出确认，之后传送完最后的数据：ACK=1，ack=u+1，seq=v
        + 服务器已经没有数据要传送，通知释放连接：FIN=1，ACK=1，seq=w，ack=u+1
        + 客户机收到连接释放报文，发出确认：ACK=1，seq=u+1，ack=w+1
        + 再经过2MSL后，客户机连接关闭
+ TCP可靠传输
    + 校验：同UDP，==校验**首部和数据**==
    + 序号：当前报文段数据第一个字节的序号
    + ==确认：期望收到对方下一个报文段数据第一个字节的序号==。确认号为k时，必须全部收到0-k-1
    + 重传
        + 超时：超时未收到确认。采用自适应算法，加权平均往返时间$RTT_s=(1-\alpha)(旧RTT_s)+\alpha*(新RTT),\alpha=0.125$，初始为$RTT$。偏差的加权平均值$RTT_D=(1-\beta)(旧RTT_D)+\beta|RTT_s-新RTT|$，初始为$\frac{1}{2}RTT$。超时重传时间$RTO=RTT_s+4*RTT_D$
        + ==冗余ACK（冗余确认、快速重传）：收到3个对同一报文段的ACK时，认为该报文段的后一个报文段已经丢失，重传。比超时更快==
+ TCP流量控制：基于窗口滑动原理，区别数据链路层滑动窗口：传输层的窗口在端到端之间、可动态变化
    + 接收方的接收窗口rwnd：和自身缓存大小有关，通过TCP报文段的窗口字段通知发送方
    + 发送方的拥塞窗口cwnd：和网络拥塞程度有关
    + ==发送窗口=$min\{rwnd,cwnd\}$==，单位为==**字节**==而不是个
+ TCP拥塞控制：全局性的过程，涉及所有主机、路由器，并由发送方自己控制自己；流量控制是由接收方控制发送方
    + ==慢开始和拥塞避免：配套==
        + ==慢开始：cwnd从1开始，每次翻倍，**若下一次cwnd将超过慢开始门限ssthresh，下一次cwnd为ssthresh**，开始拥塞避免==
        + ==拥塞避免：cwnd每次加1，当出现超时时，令$ssthresh=max\{\frac{1}{2} cwnd,2\},cwnd=1$==。即乘法减小、加法增大
        + 若$cwnd<ssthresh$：慢开始
        + 若$cwnd\ge ssthresh$：拥塞避免
    + ==快重传和快恢复：配套==
        + ==快重传：收到3个对同一报文段的冗余ACK时，认为该报文段的后一个报文段已经丢失，重传。比超时更快==。例如==B给A发送ack=100，A发送seq=100但丢失，B再发3个ack=100，此时才快重传（即第**四**个），而不是B发的第三个ack=100报文后==
        + ==快恢复：收到3个对同一报文段的ACK时，令$ssthresh=max\{\frac{1}{2}cwnd,2\},cwnd=ssthresh$，然后开始拥塞避免==

## 零碎知识点
+ 可靠即有应答机制，而不是有连接
+ TCP规定==HTTP的**服务器**进程端口为80==
+ 题中给了rwnd时，一定注意发送窗口取二者最小值
+ TCP面向字节，但只对一个报文段发一个确认，因此是对报文段确认
+ ==TCP流量控制第32KB传输结束后，cwnd应该为64KB而不是32KB==
+ ==开销：TCP 20B，UDP 8B，IP 20B，以太网帧26B（18B首部尾部+7B前同步码+1B帧开始定界符）==
+ TCP的重传和GBN不同：==TCP中失序部分不丢弃，如收到124，4不丢弃，只需重传3==；GBN中，4丢弃，重传34
+ ==两个进程可以建立多个TCP连接==

# 应用层

## 应用层网络模型
+ ==客户\服务器模型（C/S）==：如Web、文件传输协议FTP、远程登陆、电子邮件
    + ==客户必须知道服务器程序地址，服务器无需知道客户地址==
    + 客户是服务请求方，服务器是服务提供方
    + 客户机之间不能直接通信，可扩展性差
+ 对等P2P模型
    + 每个结点平等，系统效率和资源利用率高
    + 减轻对服务器压力，客户机之间可以直接共享资源，可扩展性好
    + 获取服务同时提供服务，占用内存多

## ==域名系统DNS（Domain Name System）==：主机名和IP地址转换，C/S模型，==UDP==，端口53
+ 层次域名空间
    + 因特网采用层级树状结构的命名方法
    + 域名：一级域名com，二级域名baidu，三级域名www
+ 域名服务器
    + 域名到IP地址的解析由域名服务器完成
    + 域名服务器：只记录本区内的域名和IP地址的映射，以及其他域名服务器信息
        + 根域名服务器：管辖顶级域。本地域名服务器无法解析时，==首先求助根域名服务器==。不能直接转换待查寻域名，而要告诉本地域名服务器找哪一个顶级域名服务器
        + 顶级域名服务器：管辖二级域名
        + 授权域名服务器：每台主机必须在授权域名服务器处登记。授权域名服务器一定能将主机名转换为IP地址
        + 本地域名服务器
+ 解析器
    + 正向解析：域名->IP地址
    + 反向解析：IP地址->域名
    + 过程：本地DNS客户端构造DNS请求报文，以UDP数据报方式发给本地域名服务器，递归查询或递归与迭代相结合查询。如www.buaa.edu.cn
        + ==递归查询：主机->本地->根->cn顶级->edu.cn授权->buaa.edu.cn授权->edu.cn授权->cn顶级->根->本地->主机==。根域名服务器负载大，不使用
        + ==递归与迭代结合查询==：
            + ==递归：主机->本地，本地->主机==
            + ==迭代：本地->根->本地->cn顶级->本地->edu.cn授权->本地->buaa.edu.cn授权->本地==
    + 结果：存在高速缓存中，一段时间内相同域名查询可以直接返回结果，主机发出的dns查询为==0==

## ==文件传输协议FTP（File Transfer Protocol）==：C/S模型，==TCP==，控制连接端口21，数据连接端口20
+ 功能
    + 不同种类主机系统之间传输文件
    + 提供匿名FTP
    + 用户对远程FTP服务器上文件管理
+ 可靠性要求高，使用TCP
+ 主进程和从属进程
    + 主进程：接受新请求
    + 从属进程：若干个，处理单个请求
+ 控制连接：==服务器为21端口==，传输控制信息，不传文件，外带传送
+ 数据连接：==服务器为20端口==，传送文件，传送完后释放

## 电子邮件系统

### 电子邮件系统组成
+ 用户代理UA（User Agent）：用户与电子邮件系统的接口，撰写、显示、处理邮件。如outlook，foxmail，thunderbird
+ 邮件服务器：发送、接收邮件，报告邮件传送情况。C\S模式
+ 电子邮件使用协议
    + ==邮件发送协议：SMTP，推，用户代理向邮件服务器发送邮件、邮件服务器向邮件服务器发送邮件==
    + 邮件读取协议
        + ==POP3，拉，用户协议向邮件服务器读取邮件==
        + 网际报文存取协议IMAP

### 电子邮件格式
+ 格式
    + 信封
    + 内容
        + 首部：包括必需的To:、可选的Subject:
        + 主体
+ 多用途网际邮件扩充MIME：没有代替或改变SMTP，而是在用户和SMTP之间增加MIME，使得邮件主体可以包含非ASCII码字符（如中文）

### ==简单邮件传输协议SMTP（Simple Mail Transfer Protocol）==：C\S模式，TCP，端口25，推
+ 建立连接：不使用中间服务器，直接在发送方和接收方邮件服务器之间建立TCP连接
+ 邮件传送
+ 连接释放

### ==邮局协议POP3（Post Office Protocol）：C\S模式==，TCP，端口110，拉
+ 明文密码
+ 客户端可以选择下载并保留和下载并删除

### 基于万维网的电子邮件
+ 如Hotmail、Gmail：用户代理到服务器间为HTTP，服务器之间为SMTP，服务器到用户为HTTP

## 万维网WWW（World Wide Web）：C\S模式，TCP
+ 万维网：资料空间，由统一资源定位符URL标识，资源通过超文本传输协议HTTP传送
    + 统一资源定位符URL：标识万维网上各种文档，每个文档在万维网内有唯一标识符URL。$<协议>://<主机>:<端口>/<路径>$，协议为HTTP或FTP，主机为域名或IP地址，端口和路径可省略
    + ==超文本传输协议HTTP（Hypertext Transfer Protocol）==：规定浏览器和服务器之间请求和响应的格式，面向事务
        + ==TCP，80端口==
        + 无状态的：不记得是否服务过这个客户。使用cookie才能识别用户，存在用户端
        + 无连接的：虽然使用TCP连接，但交换HTTP请求报文和响应报文前不需要建立HTTP连接
        + 非持久连接和持久连接，即==HTTP报文的Connection字段==
            + ==非持久连接Close==：t=RTT（建立TCP连接）+RTT（请求和接收文档）+文档传输时间，如HTTP1.0
            + ==持久==连接==keep-alive==：如HTTP1.1
                + 非流水线：每个引用一个RTT
                + 流水线：所有引用共计一个RTT
        + HTTP报文
            + 请求报文
            + 响应报文
    + 超文本标记语言HTML

## 零碎知识点
+ 域名和IP地址不是一对一关系，如两块网卡的主机连接到两个网络时有2个IP地址和1个域名，虚拟主机中一个主机有1个IP地址和多个域名

# ==总结==
+ 广域网与局域网

| 网络           | 局域网             | 广域网                     |
| -------------- | ------------------ | -------------------------- |
| 传输技术       | 广播式             | 点对点的存储转发           |
| TCP/IP模型层次 | 物理层、数据链路层 | 物理层、数据链路层、网络层 |

+ 以太网IEEE802.3
    + 曼彻斯特编码（每个码元两个电压），故波特率=2*比特率
    + 1-坚持CSMA：忙则等待，空闲必发
    + 碰撞立即停止发送


+ 无线局域网IEEE802.11
    + 载波侦听多路访问/碰撞避免CSMA/CA
    + 碰撞也要发送完毕
    + 正交频分复用


+ 协议

| 协议       | 停止-等待ARQ                      | 后退N帧ARQ（GBN）                                            | 选择重传ARQ（SR）                                            | 纯ALOHA                                                      | 时隙ALOHA                                                    | 载波侦听多路访问CSMA                         | 载波侦听多路访问/碰撞检测CSMA/CD                             | 载波侦听多路访问/碰撞避免CSMA/CA      | MAC                | 点对点PPP                                    | 高级数据链路控制HDLC                                         | IP                 | 地址解析ARP                                 | 网际控制报文ICMP           | 开放最短路径优先OSPF                                     | 因特网组管理IGMP | 传输控制TCP                                                  | 用户数据报UDP                                      | 动态主机配置DHCP                  | 路由信息RIP                                                  | 边界网关BGP                                                  | 文件传输FTP                             | 超文本传输HTTP  |
| ---------- | --------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | -------------------------------------------- | ------------------------------------------------------------ | ------------------------------------- | ------------------ | -------------------------------------------- | ------------------------------------------------------------ | ------------------ | ------------------------------------------- | -------------------------- | -------------------------------------------------------- | ---------------- | ------------------------------------------------------------ | -------------------------------------------------- | --------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | --------------------------------------- | --------------- |
| 层级       | 数据链路层                        | 数据链路层                                                   | 数据链路层                                                   | 数据链路层                                                   | 数据链路层                                                   | 数据链路层                                   | 数据链路层                                                   | 数据链路层                            | 数据链路层         | 数据链路层                                   | 数据链路层                                                   | 网络层             | 网络层                                      | 网络层                     | 网络层                                                   | 网络层           | 传输层                                                       | 传输层                                             | 应用层                            | 应用层                                                       | 应用层                                                       | 应用层                                  | 应用层          |
| 连接、可靠 |                                   |                                                              |                                                              |                                                              |                                                              |                                              |                                                              |                                       | ==无连接、不可靠== | ==面向连接、不可靠==                         | ==面向连接、可靠==                                           | ==无连接、不可靠== |                                             |                            |                                                          |                  | ==面向连接、可靠==                                           | ==无连接、不可靠==                                 |                                   |                                                              |                                                              |                                         |                 |
| 内容       | 流量控制，发送==一个==帧后等待ACK | 流量控制，==发送窗口$W_T\le 2^n-1$==，ACK，==返回第n个帧的确认帧表明n及以前的帧都收到，出错时需要重传错误帧和之后所有帧== | 流量控制，==接收窗口=发送窗口=$2^{n-1}$==，ACK，==可无序接收== | 局域网介质访问控制，不检测冲突，冲突后等待一段时间重发，吞吐量=0.184\*带宽 | 局域网介质访问控制，划分时隙，规定只能在时隙开始时发一个帧，吞吐量=0.368\*带宽 | 局域网介质访问控制，==1坚持、非坚持、p坚持== | 局域网介质访问控制，边听边发，争用期$2\tau$，==最小帧长$2\tau*数据传输率$==，==二进制指数退避== | 局域网介质访问控制，随机退避，==ACK== |                    | 广域网，面向字节，字节填充（默认）或比特填充 | 广域网，面向比特，==比特填充==，分为信息帧、监督帧、无编号帧 |                    | 完成IP地址到MAC地址映射，发送广播，响应单播 | 主机或路由器报告差错和异常 | 泛洪法向==所有==路由器发送自己和==相邻==路由器的链路状态 | 组播             | 文件传输协议==FTP==，超文本传输协议HTTP，远程登陆TELNET，==可无序== | 小文件传送协议TFTP，==DNS==，SNMP，实时传输协议RTP | 给主机动态分配临时IP地址，基于UDP | 基于==UDP==，最多15跳，和==相邻==路由器维护自己与==所有==路由器的信息，慢收敛，距离-向量算法 | 基于==TCP==，选BGP发言人进行通信，知道完整路径，路径-向量算法 | 基于TCP，21端口建立连接，20端口传输数据 | 基于TCP，80端口 |

+ 数据

| 数据     | MAC帧                               | IPv4                                                         | IPv6                   | TCP报文段                                                    | UDP用户数据报    |
| -------- | ----------------------------------- | ------------------------------------------------------------ | ---------------------- | ------------------------------------------------------------ | ---------------- |
| 层级     | 数据链路层                          | 网络层                                                       | 网络层                 | 传输层                                                       | 传输层           |
| 控制信息 | ==8B前导码+18B首部尾部==            | ==首部20B==+可变                                             | 相比IPv4简化了校验字段 | ==首部8B==                                                   | ==固定20B==+可变 |
| 数据长度 | 46B-1500B（MTU）                    | -1480B                                                       |                        | 小于最大报文长度MSS                                          |                  |
| 总长度   | 64B-1518B                           | 46B-1500B（MTU）                                             |                        |                                                              |                  |
| 校验     | CRC校验首部和数据，==不校验前导码== | 只校验首部，==不校验数据==                                   | ==无==                 | 首部和数据部分                                               | 首部和数据部分   |
| 重要字段 |                                     | ==首部长度单位4B，总长度单位1B，片偏移单位8B==，分片后标识相同，标志MF=1表示其后有分片，标志DF=0表示允许分片，生存时间TLL，协议2为组播，==6为TCP，17为UDP== | 不允许分片             | 序号seq单位4B，确认号ack单位4B（对方下一次发来第一个报文序号），同步位SYN、确认位ACK（连接请求报文SYN=1，ACK=0，无数据，有seq；连接接收报文SYN=1，ACK=1，无数据，有seq；其他报文SYN=0，ACK=1），数据偏移（首部长度）单位4B |                  |

+ 地址

| 地址 | MAC地址            | IPv4地址   | IPv6地址              |
| ---- | ------------------ | ---------- | --------------------- |
| 层级 | 数据链路层         | 网络层     | 网络层                |
| 长度 | 6B=48b             | 4B=32b     | 16B=128b              |
| 表示 | 冒号（减号）16进制 | 点分10进制 | 冒号（减号）16进制    |
| 示例 | 02-6-8c-e4-b1-21   | 127.0.0.1  | 4BF5::BA5F:39A:A:2176 |

+ 设备

| 介质       | 中继器（转发器）                                      | 集线器Hub                                                    | 网桥                                                         | 交换机           | 路由器（网关） |
| ---------- | ----------------------------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ---------------- | -------------- |
| 层级       | 物理层                                                | 物理层                                                       | 数据链路层                                                   | 数据链路层       | 网络层         |
| 分割冲突域 | ×                                                     | ×                                                            | ==√==                                                        | ==√==            | ==√==          |
| 分割广播域 | ×                                                     | ×                                                            | ×                                                            | ×                | ==√==          |
| 作用       | 放大==数字==信号（如10BASET的基带传输），==不能转发== | 多端口中继器，信号放大后发送到==除输入端口外==的其他所有端口 | 透明网桥根据==源MAC地址==进行==自学习算法==，源路由网桥选择最佳路由 | 多端口的透明网桥 | 可抑制广播风暴 |

# 大题
+ 时延计算：
    + 若总数据量x，经过k段链路，分组长度p，每段链路的数据传输率都是b。忽略传播时延和排队时间，则：
        + ==电路交换：==
            + ==发送时延：x/b==
        + ==报文交换==
            + ==发送时延：x/b\*k==，即k段链路每段都要发送整个报文
        + ==分组交换==
            + ==发送时延：x/b，看成一个整体；或(x/p)\*(p/b)。这里由于存储和转发部分并行，不需要乘以链路数k，而是将相差的时间归结为转发时延==
            + ==转发时延：**(k-1)\*(p/b)**，即k-1个分组发送时延==
+ GBN中帧序列比特数
    + GBN协议，数据传输率16kb/s，单向传播时延270ms，数据帧长度128-512B，ACK和数据帧等长。求信道利用率最高时，帧序列的比特数最小值
    + 取最短数据帧长度128B=128\*8b，单向发送时延128\*8/16=64ms，来回时延共64+270+64+270=668ms，在668ms中最多发送帧个数668/64=10.4个，则至少需要4b来编号
+ 连续ARQ中窗口大小为n，最多==n-1==帧已经发送但没有确认
+ 码分多址CMDA
    + 码片之间正交，点积为0
    + 若码片长度n位，将收到的序列每n位一组，每组用码片线性表示

# 英文
+ 屏蔽双绞线STP
+ 非屏蔽双绞线UTP
+ 第n层协议数据单元n-PDU
+ 第n层服务数据单元n-SDU
+ 第n层协议控制信息n-PCI
+ 正交振幅调制QAM
+ 脉码调制PCM
+ 10BASE5：同轴电缆，基带传输（数字信号），数据率10Mb/s，长度500m
+ 10BASET：双绞线
+ 10BASTFL：光纤
+ 频分多路复用FDM
+ 时分多路复用TDM
+ 统计时分多路复用（异步时分多路复用）STDM
+ 波分多路复用WDM
+ 码分多路复用CDM
+ 码分多址CDMA(Code Division Multiple Access)
+ 载波侦听多路访问CSMA(Carrier Sense Multiple Access)
+ 载波侦听多路访问/碰撞检测CSMA/CD(Collision Detection)
+ 载波侦听多路访问/碰撞避免CSMA/CA(Collision Avoidance)
+ 光纤分布数字接口FDDI
+ 局域网LAN
+ 无线局域网WLAN
+ 基本服务集BSS
+ 接入点AP
+ 广域网WAN
+ 点对点PPP协议（Point-to-Point Protocol）
+ 高级数据链路控制HDLC协议（High-level Data Link Control）
+ 以太网帧最大数据单元MTU
+ 网络地址转换NAT
+ 地址解析协议ARP（Address Resolution Protocol）
+ 动态主机配置协议DHCP（Dynamic Host Configuration Protocol）
+ 自治系统AS（Autonomous System）
+ 开放最短路径优先协议OSPF
+ 边界网关协议BGP（Border Gateway Protocol）
+ 因特网组管理协议IGMP（Internet Group Management Protocol）
+ 传输控制协议TCP
+ 用户数据报协议UDP
+ 域名系统DNS（Domain Name System）
+ 文件传输协议FTP（File Transfer Protocol）
+ 简单邮件传输协议SMTP（Simple Mail Transfer Protocol）
+ 邮局协议POP3（Post Office Protocol）